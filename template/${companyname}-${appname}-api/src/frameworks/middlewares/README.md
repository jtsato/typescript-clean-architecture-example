# Middlewares

This folder contains middleware to simplify the creation of RESTful APIs using the TSOA and Express.JS frameworks

These middlewares automatically add some automatic behaviors to the API. Here is a list of them:

| Middleware | Role | 
| --- | --- | 
| `handleCors` | Handles the CORS-related headers received in the HTTP request |
| `handleBodyRequestParsing` | Parse the body of a http request to a JSON |
| `handleErrors` | Handles the errors and exceptions thrown by the application in a friendly way |
| `handleCompression` | Compress the http response using GZIP |
| `apiDocsHandler` | Create a route to the Swagger UI on the route `/api-docs/` |
| `logRequest` | Print the logs of each http request received |

To use this middleware in the application, it is necessary to add the following lines of code in a global code `/src/frameworks/webserver/express`.

### How to use

```javascript
import { RegisterRoutes } from './routes'; // (auto-generated by TSOA)
import swaggerDocs from './swagger.json'; // (auto-generated by TSOA)

import express from 'express';

// starts the express
this.app = express();

// Register all requests/responses
const reqRespHandlers = Middlewares.getRequestResponseMiddlewares(swaggerDocs);
for (const middleware of reqRespHandlers) {
   middleware(this.app);
}

// Register the routes
RegisterRoutes(this.app);

// Register exeptions
const errorHandlerFactory = Middlewares.getErrorHandlerMiddlewareFactory();
errorHandlerFactory.registerExpectedError('400', MyValidationError);
errorHandlerFactory.registerExpectedError('422', MyBusinessError);
errorHandlerFactory.handler(this.app)
```
